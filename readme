
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt update
apt-cache policy docker-ce
sudo apt install docker-ce
sudo usermod -aG docker ${USER}

export GITLAB_VERSION=v15.1.1
export HOSTNAME=
export TOKEN=

docker run -d --name gitlab-runner -v /var/run/docker.sock:/var/run/docker.sock -v /etc/gitlab-runner:/etc/gitlab-runner gitlab/gitlab-runner:$GITLAB_VERSION
docker run --rm -t -i -v /var/run/docker.sock:/var/run/docker.sock -v /etc/gitlab-runner:/etc/gitlab-runner gitlab/gitlab-runner:$GITLAB_VERSION register \
--non-interactive \
--executor "docker" \
--docker-image docker:stable \
--url "https://gitlab.agile.nat.bt.com" \
--registration-token "$TOKEN" \
--description "$HOSTNAME" \
--tag-list "gnf,docker,jnpr" \
--run-untagged "true" \
--locked "false"
